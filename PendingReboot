# Streamlined Script to Check Pending Reboot

# Define Registry Keys to Check

$RebootRegKey1 = "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Component Based Servicing\RebootPending"

$RebootRegKey2 = "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update\RebootRequired"

$RebootRegKey3 = "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Component Based Servicing\RebootInProgress"



# Initialize Pending Reboot Flag

$PendingReboot = $false



# Check Registry Keys

if (Test-Path $RebootRegKey1 -or Test-Path $RebootRegKey2 -or Test-Path $RebootRegKey3) {

    $PendingReboot = $true

}



# Output Results in SolarWinds-Compatible Format

if ($PendingReboot -eq $true) {

    Write-Host "Message.RebootStatus: Server is pending reboot."

    Write-Host "Statistic.RebootStatus: 1"

} else {

    Write-Host "Message.RebootStatus: Server is not pending reboot."

    Write-Host "Statistic.RebootStatus: 0"

}





$PendingReboot = Get-WmiObject -Namespace "ROOT\CCM\ClientSDK" -Class CCM_ClientUtilities | Select-Object IsRebootPending
if ($PendingReboot.IsRebootPending -eq $true) {
    Write-Host "Message: Server is pending reboot."
    Write-Host "Statistic: 1"
} else {
    Write-Host "Message: Server is not pending reboot."
    Write-Host "Statistic: 0"
}
